<% if notice %>
  <div class="notice" style="background-color: #d4edda; color: #155724; padding: 10px; margin-bottom: 15px; border-radius: 4px;">
    <%= notice %>
  </div>
<% end %>

<h1>Washington Memorial Map</h1>

<div id="map" style="width: 50%; height: 500px;"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<div>
  <%= link_to "Add New Entry", new_map_entry_path %>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    initMap();
  });
  
  document.addEventListener('DOMContentLoaded', function() {
    initMap();
  });
  
  function initMap() {
    // Clear any existing map
    const mapContainer = document.getElementById('map');
    if (mapContainer._leaflet_id) {
      mapContainer._leaflet = null;
    }
    
    const map = L.map('map').setView([47.7511, -120.7401], 7); // Center of Washington State
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // Fetch map entries from the server
    fetch('/map_entries.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(entries => {
        console.log('Entries loaded:', entries);
        entries.forEach(entry => {
          L.marker([entry.latitude, entry.longitude])
            .addTo(map)
            .bindPopup(`<b>${entry.title}</b><br>${entry.description}`);
        });
      })
      .catch(error => {
        console.error('Error loading map entries:', error);
      });
  }
</script>